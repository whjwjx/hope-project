import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,d as e,o as n}from"./app-C79d5bQj.js";const a={};function r(o,s){return n(),t("div",null,[...s[0]||(s[0]=[e(`<h3 id="技术优化总结-实现-三级颗粒度-的按钮权限控制" tabindex="-1"><a class="header-anchor" href="#技术优化总结-实现-三级颗粒度-的按钮权限控制"><span><strong>技术优化总结：实现“三级颗粒度”的按钮权限控制</strong></span></a></h3><h4 id="_1-问题背景-为何路由会崩溃" tabindex="-1"><a class="header-anchor" href="#_1-问题背景-为何路由会崩溃"><span><strong>1. 问题背景：为何路由会崩溃？</strong></span></a></h4><p>在重构权限系统时，若直接将 <code>userStore.permissions</code> 从<strong>对象数组</strong>（包含路由信息）强转为<strong>字符串数组</strong>（仅含名称），会导致路由系统在递归处理二级、三级节点时，无法在字符串上挂载 <code>meta</code> 属性，从而引发 <code>TypeError</code> 并导致页面导航中断。</p><hr><h4 id="_2-后端实现-结构化权限树-code-模式" tabindex="-1"><a class="header-anchor" href="#_2-后端实现-结构化权限树-code-模式"><span><strong>2. 后端实现：结构化权限树 (Code 模式)</strong></span></a></h4><p>后端应提供一套具备层级关系的权限树，并为<strong>三级按钮</strong>定义唯一的权限标识（Code）：</p><ul><li><strong>层级结构</strong>： <ul><li><strong>一级 (目录)</strong>：<code>community</code> (小区管理)</li><li><strong>二级 (页面)</strong>：<code>community.leader</code> (负责人管理页面)</li><li><strong>三级 (操作)</strong>：<code>community.leader.add</code> (<strong>该页面下的新增按钮</strong>)</li></ul></li><li><strong>字段规范</strong>：<div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;title&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;新增负责人&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;code&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;community.leader.add&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 唯一的权限标识</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1-目录, 2-菜单, 3-按钮</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;parentId&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;...&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="_3-前端实现-权限数据-双轨制" tabindex="-1"><a class="header-anchor" href="#_3-前端实现-权限数据-双轨制"><span><strong>3. 前端实现：权限数据“双轨制”</strong></span></a></h4><p>前端通过一套数据、两种形态，完美兼容动态路由与三级按钮鉴权：</p><ul><li><strong>轨道一：对象形态 (路由使用)</strong><br><code>permissions.value</code> 保留完整的树形对象，确保二级路由页面能正常加载和跳转。</li><li><strong>轨道二：扁平化形态 (按钮鉴权)</strong><br> 新增 <code>authButtons.value</code> 数组。通过<strong>递归算法</strong>提取树中所有 <code>type: 3</code> 的 <code>code</code>（或 <code>title</code>），形成扁平字符串数组：<br><code>[&#39;community.list&#39;, &#39;community.leader.add&#39;, &#39;community.leader.edit&#39;]</code></li><li><strong>精准鉴权调用</strong>：<br> 在 <code>community/leader/index.vue</code> 页面中，针对三级按钮进行控制：<div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-html"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 只有具备该二级页面下具体三级操作权限的用户才显示 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">el-button</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> v-auth</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&#39;community.leader.add&#39;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;新增负责人&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">el-button</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="_4-总结" tabindex="-1"><a class="header-anchor" href="#_4-总结"><span><strong>4. 总结</strong></span></a></h4><ul><li><strong>颗粒度</strong>：将权限细化到“二级页面下的三级按钮”，实现真正的精细化控制。</li><li><strong>解耦</strong>：路由跳转由对象树负责，按钮显示由扁平化的 <code>code</code> 数组负责，互不干扰。</li><li><strong>安全</strong>：后端通过 <code>code</code> 统一管理，前端只需关注标识符，即便菜单名称修改，功能权限依然稳固。</li></ul><hr>`,15)])])}const d=i(a,[["render",r]]),p=JSON.parse('{"path":"/zh/posts/internship/2025-12-25.html","title":"实习日志 - 2025-12-25","lang":"zh-CN","frontmatter":{"title":"实习日志 - 2025-12-25","icon":"pen-to-square","date":"2025-12-25T00:00:00.000Z","category":["实习日志"],"tag":["实习","日志"],"description":"技术优化总结：实现“三级颗粒度”的按钮权限控制 1. 问题背景：为何路由会崩溃？ 在重构权限系统时，若直接将 userStore.permissions 从对象数组（包含路由信息）强转为字符串数组（仅含名称），会导致路由系统在递归处理二级、三级节点时，无法在字符串上挂载 meta 属性，从而引发 TypeError 并导致页面导航中断。 2. 后端实现...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"实习日志 - 2025-12-25\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-12-25T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-26T02:17:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/zh/posts/internship/2025-12-25.html"}],["meta",{"property":"og:site_name","content":"博客演示"}],["meta",{"property":"og:title","content":"实习日志 - 2025-12-25"}],["meta",{"property":"og:description","content":"技术优化总结：实现“三级颗粒度”的按钮权限控制 1. 问题背景：为何路由会崩溃？ 在重构权限系统时，若直接将 userStore.permissions 从对象数组（包含路由信息）强转为字符串数组（仅含名称），会导致路由系统在递归处理二级、三级节点时，无法在字符串上挂载 meta 属性，从而引发 TypeError 并导致页面导航中断。 2. 后端实现..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-26T02:17:34.000Z"}],["meta",{"property":"article:tag","content":"日志"}],["meta",{"property":"article:tag","content":"实习"}],["meta",{"property":"article:published_time","content":"2025-12-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-26T02:17:34.000Z"}]]},"git":{"createdTime":1766715454000,"updatedTime":1766715454000,"contributors":[{"name":"王华江","username":"","email":"1312513223@qq.com","commits":1}]},"readingTime":{"minutes":1.8,"words":539},"filePathRelative":"zh/posts/internship/2025-12-25.md","excerpt":"<h3><strong>技术优化总结：实现“三级颗粒度”的按钮权限控制</strong></h3>\\n<h4><strong>1. 问题背景：为何路由会崩溃？</strong></h4>\\n<p>在重构权限系统时，若直接将 <code>userStore.permissions</code> 从<strong>对象数组</strong>（包含路由信息）强转为<strong>字符串数组</strong>（仅含名称），会导致路由系统在递归处理二级、三级节点时，无法在字符串上挂载 <code>meta</code> 属性，从而引发 <code>TypeError</code> 并导致页面导航中断。</p>","autoDesc":true}');export{d as comp,p as data};
