import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,d as t,o as a}from"./app-CBl1hAF3.js";const n={};function r(l,s){return a(),e("div",null,[...s[0]||(s[0]=[t(`<hr><p>icon: pen-to-square<br> date: 2022-01-09<br> category:</p><ul><li>Cherry<br> tag:</li><li>red</li><li>small</li><li>round</li></ul><h1 id="每日技术随笔-权限系统的-双轨制-重构——从路由崩溃到精细化鉴权" tabindex="-1"><a class="header-anchor" href="#每日技术随笔-权限系统的-双轨制-重构——从路由崩溃到精细化鉴权"><span>每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权</span></a></h1><p><strong>日期：</strong> 2025年12月25日<br><strong>分类：</strong> 前端开发 / Vue3 / 架构设计</p><hr><p>以下是为您准备的今日技术博客，记录了今天在权限系统优化过程中遇到的挑战与解决方案。</p><h3 id="_1-引言" tabindex="-1"><a class="header-anchor" href="#_1-引言"><span><strong>1. 引言</strong></span></a></h3><p>在后台管理系统中，权限控制（RBAC）始终是核心环节。今天在优化 <code>Fantastic-admin</code> 框架的权限逻辑时，经历了一次从“简单修改”到“系统性重构”的过程。</p><h3 id="_2-遇到的挑战-一个-map-引发的崩溃" tabindex="-1"><a class="header-anchor" href="#_2-遇到的挑战-一个-map-引发的崩溃"><span><strong>2. 遇到的挑战：一个 <code>map</code> 引发的崩溃</strong></span></a></h3><p>最初的需求非常简单：<strong>将后端返回的权限对象数组转换为标题（title）数组，以便在页面中更直观地使用 <code>v-auth</code> 指令。</strong></p><p>我直接在 <code>userStore</code> 中做了如下修改：</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-typescript"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">permissions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">item</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>后果：</strong> 整个系统瞬间瘫痪，控制台抛出大量 <code>TypeError: Cannot create property &#39;meta&#39; on string</code> 错误。</p><p><strong>深度复盘：</strong><br> 在成熟的后台框架中，<code>permissions</code> 往往承担着“一职多能”的角色：</p><ol><li><strong>鉴权</strong>：作为字符串，供按钮级指令匹配。</li><li><strong>路由生成</strong>：作为对象，被路由系统递归处理并注入 <code>meta</code> 信息。<br> 当我把对象数组强转为字符串数组时，路由系统试图在字符串（如 <code>&quot;订单管理&quot;</code>）上挂载 <code>meta</code> 属性，直接导致了溢出崩溃。</li></ol><hr><h3 id="_3-解决方案-权限数据的-双轨制" tabindex="-1"><a class="header-anchor" href="#_3-解决方案-权限数据的-双轨制"><span><strong>3. 解决方案：权限数据的“双轨制”</strong></span></a></h3><p>为了兼顾路由系统的稳定性和业务鉴权的便捷性，我引入了“双轨制”存储方案：</p><ul><li><strong><code>permissions</code> (对象轨)</strong>：保留后端原始的对象结构（包含 <code>path</code>, <code>component</code>, <code>children</code> 等），专供路由生成系统使用。</li><li><strong><code>authButtons</code> (标识轨)</strong>：新增一个扁平化的字符串数组，存储所有的权限 <code>code</code> 或 <code>title</code>，专供 <code>v-auth</code> 指令鉴权使用。</li></ul><p><strong>核心代码实现：</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-typescript"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getPermissions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> commonApi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMenuTree</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 轨道1：原始对象，维持路由系统运转</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  permissions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [] </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 轨道2：递归提取标识，服务于按钮级鉴权</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  authButtons</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> flattenPermissionCodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_4-架构进阶-解耦显示与逻辑" tabindex="-1"><a class="header-anchor" href="#_4-架构进阶-解耦显示与逻辑"><span><strong>4. 架构进阶：解耦显示与逻辑</strong></span></a></h3><p>在后续的优化中，我们意识到直接用 <code>title</code> 鉴权的风险——如果产品经理改了菜单名称，前端代码必须跟着改。</p><p>因此，我制定了一套<strong>权限标识符 (Permission Code)</strong> 规范：</p><ul><li>后端返回唯一的 <code>code</code>（如 <code>community.leader.edit</code>）。</li><li>前端通过递归算法，无论权限点藏在多深的子菜单下，都能精准捕获。</li><li>编写了配套的《前后端对接文档》，明确了 <code>type</code>（目录/菜单/按钮）的划分。</li></ul><hr><h3 id="_5-总结与启示" tabindex="-1"><a class="header-anchor" href="#_5-总结与启示"><span><strong>5. 总结与启示</strong></span></a></h3><ol><li><strong>敬畏底层框架数据流</strong>：在修改全局 Store 数据时，必须回溯该数据的所有消费场景，避免“按下葫芦浮起瓢”。</li><li><strong>职责单一原则</strong>：显示的数据（Title）和逻辑的数据（Code）应当分离。</li><li><strong>递归的力量</strong>：处理树形结构（菜单、权限）时，一份健壮的递归算法是权限系统的灵魂。</li></ol><p><strong>今日感悟：</strong> 优秀的权限系统应当是后端配置灵活、前端调用简单的。每一次报错都是对底层原理加深理解的机会。</p><hr><p><em>作者：[你的名字/AI助手]</em><br><em>记录于 Trae IDE - 您的智能编程伙伴</em></p>`,33)])])}const o=i(n,[["render",r]]),d=JSON.parse('{"path":"/posts/12-25.html","title":"每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权","lang":"en-US","frontmatter":{"description":"icon: pen-to-square date: 2022-01-09 category: Cherry tag: red small round 每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权 日期： 2025年12月25日 分类： 前端开发 / Vue3 / 架构设计 以下是为您准备的今日技术博客，记录了今天在权限系统优化过程中...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-26T02:17:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/hope-project/posts/12-25.html"}],["meta",{"property":"og:site_name","content":"Blog Demo"}],["meta",{"property":"og:title","content":"每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权"}],["meta",{"property":"og:description","content":"icon: pen-to-square date: 2022-01-09 category: Cherry tag: red small round 每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权 日期： 2025年12月25日 分类： 前端开发 / Vue3 / 架构设计 以下是为您准备的今日技术博客，记录了今天在权限系统优化过程中..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-26T02:17:34.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-26T02:17:34.000Z"}]]},"git":{"createdTime":1766715454000,"updatedTime":1766715454000,"contributors":[{"name":"王华江","username":"","email":"1312513223@qq.com","commits":1}]},"readingTime":{"minutes":2.83,"words":849},"filePathRelative":"posts/12-25.md","excerpt":"<hr>\\n<p>icon: pen-to-square<br>\\ndate: 2022-01-09<br>\\ncategory:</p>\\n<ul>\\n<li>Cherry<br>\\ntag:</li>\\n<li>red</li>\\n<li>small</li>\\n<li>round</li>\\n</ul>\\n<h1>每日技术随笔：权限系统的“双轨制”重构——从路由崩溃到精细化鉴权</h1>\\n<p><strong>日期：</strong> 2025年12月25日<br>\\n<strong>分类：</strong> 前端开发 / Vue3 / 架构设计</p>\\n<hr>\\n<p>以下是为您准备的今日技术博客，记录了今天在权限系统优化过程中遇到的挑战与解决方案。</p>","autoDesc":true}');export{o as comp,d as data};
